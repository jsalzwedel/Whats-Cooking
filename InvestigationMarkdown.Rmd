---
title: "Exploring Ingredients Data Set"
author: "jsalzwedel"
date: "09/13/2015"
output: html_document
---

Let's take a look at the Kaggle "What's cooking" data set.  The goal of the
competition is to predict the cuisine of a recipe based on the recipe's 
ingredients.

# Exploratory analysis

## Read in the data

The training and test files are in the json format.  [This site](http://rstudio-pubs-static.s3.amazonaws.com/31702_9c22e3d1a0c44968a4a1f9656f1800ab.html) makes a pretty
strong argument that the jsonlite library is generally the best package to use
for parsing json data.


```{r, message=FALSE}
library(jsonlite)
file <- "train.json"
trainFromJSON <- fromJSON(txt=file)
```

The data.table package makes viewing data much more convenient.

```{r}
library(data.table)
train <- data.table(trainFromJSON)
```

## Preliminary look

Let's take a quick look at the data.

```{r}
head(train,2)
```

We have three columns: ID of the recipe, type of cuisine, and list of
ingredients.  The ingredients entry for a given recipe is a list of character
vectors, one for each ingredient.  We'll have to split those apart later.

What are the unique cuisine types?

```{r}
unique(train$cuisine)
```



# Analysis

## Strategy

We want to look at each ingredient and see how often it is used in a given
type of cuisine.  There are many ways to use this information.  The simplest
might be to ascribe a single cuisine to each ingredient based on where it is
used most.  When we want to make predictions, each ingredient in a recipe
will weight that recipe towards a certain cuisine.  We can then then add up the
weights to see which cuisine is most favored.

Our analysis strategy will be as follows:

- Make a new data table with a row for each ingredient from each recipe.  We'll
keep the cuisine and recipe ID as additional columns.  

- For each ingredient, see where it is most often used, and associate it with
that type of cuisine.  Here we need to be careful to not be biased by the raw
number of recipes for any given cuisine. For example, cabbage might be used in 
10/100 French recipes, but in 5/5 Korean recipes.

- Make a new data table for the test set with a row for each recipe.

- Use the previously determined ingredient weights to determine which cuisine has
a plurality among the ingredients.


## Reformatting the data

Let's make a new data table for the ingredients.  First, unpack the list of
ingredients.  Also, keep track of how many ingredients belong to each recipe.
```{r}
ingredientList <- unlist(train$ingredients)
nlengths <- sapply(train$ingredients, length)
```

Now make the data table

```{r}
ingredFrame <- data.frame(id = rep(train$id, nlengths),
                        cuisine = rep(train$cuisine, nlengths),
                        ingredient = ingredientList)
ingredients <- setDT(ingredFrame)
```



## Looking at the ingredients

Let's get a list of unique ingredients.

```{r}
uniqueIng <- unique(ingredients$ingredient)
```

Let's tabulate cuisines by ingredient using the dplyr package

```{r, message=FALSE}
library(dplyr)
```

```{r}
ingtbl <- as.tbl(ingredients)
occurances <- count(ingtbl, c("ingredient","cuisine"))
```
